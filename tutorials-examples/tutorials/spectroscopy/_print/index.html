<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://neurodesk.org/tutorials-examples/tutorials/spectroscopy/><link rel=alternate type=application/rss+xml href=https://neurodesk.org/tutorials-examples/tutorials/spectroscopy/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=https://neurodesk.org/static/favicons/favicon.ico><link rel=apple-touch-icon href=https://neurodesk.org/static/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://neurodesk.org/static/favicons/android-192x192.png sizes=192x192><title>Spectroscopy | Neurodesk</title>
<meta name=description content="Tutorials about performing MR spectroscopy analyses"><meta property="og:url" content="https://neurodesk.org/tutorials-examples/tutorials/spectroscopy/"><meta property="og:site_name" content="Neurodesk"><meta property="og:title" content="Spectroscopy"><meta property="og:description" content="Tutorials about performing MR spectroscopy analyses"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Spectroscopy"><meta itemprop=description content="Tutorials about performing MR spectroscopy analyses"><meta itemprop=dateModified content="2025-10-30T11:09:51+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spectroscopy"><meta name=twitter:description content="Tutorials about performing MR spectroscopy analyses"><link rel=preload href=https://neurodesk.org/scss/main.min.2f0e7dd254a8510650f53c8ffbf7f9af0cc4e0d57d8872fb80c52b2440db9e88.css as=style integrity="sha256-Lw590lSoUQZQ9TyP+/f5rwzE4NV9iHL7gMUrJEDbnog=" crossorigin=anonymous><link href=https://neurodesk.org/scss/main.min.2f0e7dd254a8510650f53c8ffbf7f9af0cc4e0d57d8872fb80c52b2440db9e88.css rel=stylesheet integrity="sha256-Lw590lSoUQZQ9TyP+/f5rwzE4NV9iHL7gMUrJEDbnog=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3.8.2 integrity="sha512-l7pkV1dOURFyHCeH8I4fK9lCkQKuqhlsTCqRl3zktifDlB8oTUJ+mJPgYkK9kHpUut8j1iPquTv32t6hvTPv3g==" crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=G-4Z9774J59Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4Z9774J59Y")}</script></head><body class=td-section><header><nav class="td-navbar navbar-expand-xl navbar-dark bg-dark"><div class="container-fluid flex-md-row"><a class=navbar-brand href=https://neurodesk.org/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" viewBox="0 0 560.3 82.7"><defs><style>.st0{isolation:isolate}.st1{fill:#6ba442}.st2{fill:#fff}</style></defs><g class="st0"><path class="st2" d="M30.2 73.4h-9.9v-60h9.8l33.3 44.8V13.4h10.1v60H63.4L30.1 29.1v44.3z"/><path class="st2" d="M85.8 13.4h45l-1.4 10.3-33.8-.2v13.6l20.1-.2v11.4H95.6v13.5H129l1.8 11.6h-45v-60z"/><path class="st2" d="M141.4 13.4h9.9v50.2h28.2V13.4h9.9v51.4c0 1.2-.2 2.3-.7 3.3-.4 1-1.1 2-1.8 2.7-.8.8-1.7 1.4-2.8 1.8-1.1.4-2.2.7-3.3.7h-30.7c-1.2.0-2.3-.2-3.3-.7-1.1-.4-2-1.1-2.8-1.8-.8-.8-1.4-1.7-1.8-2.7s-.7-2.2-.7-3.3V13.4z"/><path class="st2" d="M244.7 34.8c0 4.6-1.4 7.9-4.3 10-4 2.9-8.4 4.4-13.2 4.4l17.5 24.3h-12.1l-14.7-24h-9.5v24h-8.5V13.4h29.8c10 0 15 4.9 15 14.6v6.8zm-36.3 6h15.2c3.9-.2 6.6-.7 8-1.6 2.6-1.8 3.9-2.9 3.9-3.5V29c0-2.2-.6-3.9-1.7-5-1.4-1.4-3-2.1-4.7-2.1h-20.8v18.9z"/><path class="st2" d="M306.5 59.4c0 4.8-.3 7.7-.6 8.7-.3.9-.9 1.8-1.8 2.8s-1.7 1.3-3.1 1.8c-1.3.5-3.6.7-6.8.7h-27.1c-1.2.0-2.8-.2-5-.6-2.5-.5-3.9-1.1-4.4-1.8-.9-1.5-1.6-2.4-1.8-2.7-.4-.6-.7-3.6-.7-8.7V42.1c0-8.8.0-14.1.2-15.9.0-2.6.3-5 .7-7.4.1-.8.7-1.7 1.7-2.7.6-.7 2.1-1.3 4.4-1.8 1.9-.4 3.5-.7 5-.7h27.1c3.5.0 5.7.1 6.8.6 1.3.5 2.3 1.1 3.1 1.9.9.8 1.5 1.7 2 2.7.4.8.6 3.3.6 7.4l.2 16.7c0 8.1-.1 13.6-.3 16.7zM265.4 23.3v40h31.2v-40h-31.2z"/></g><g class="st0"><path class="st1" d="M316.2 73.4v-60l31.3.3c2.5.0 5.4.6 8.7 1.9 2.6 1 4.8 2.4 6.6 4.3 2 2 3.4 4.2 4.3 6.6 1 3 1.5 5.9 1.5 8.7v17.3c0 3.2-.5 6.1-1.5 8.7s-2.4 4.8-4.2 6.6-4 3.2-6.6 4.2-5.5 1.5-8.7 1.5h-31.3zm30.7-11.2c4.9.0 8-.7 9.2-2 2.1-2.3 3.2-5.8 3.2-10.4v-14c.2-1.9-.2-3.6-1.1-5.2-.8-1.5-1.8-2.8-2.9-3.9-1.1-1.1-2.4-1.9-3.9-2.4-1.5-.6-3-.8-4.4-.8h-21.3v38.8h21.2z"/><path class="st1" d="M381 13.4h45l-1.4 10.3-33.8-.2v13.6l20.1-.2v11.4h-20.1v13.5h33.4l1.8 11.6h-45v-60z"/><path class="st1" d="M446.4 46.5c-1.1.0-2.2-.3-3.3-.7-1.1-.4-2-1.1-2.8-1.8-.8-.8-1.4-1.7-1.8-2.7-.4-1-.7-2.2-.7-3.3V22.1c0-1.2.2-2.3.7-3.3s1.1-2 1.8-2.7 1.7-1.4 2.8-1.8 2.2-.7 3.3-.7h29.1c1.2.0 2.3.2 3.3.7s1.9 1.1 2.7 1.8c1.1 1 1.7 2 1.8 2.8l.7 3.3v6.7l-9 2.7v-7.7h-28.7v14.3l29.1.5c1.2.0 2.3.3 3.3.7 1.1.4 2 1.1 2.8 1.8.8.8 1.4 1.7 1.8 2.7.4 1 .7 2.2.7 3.3V65c0 1.2-.2 2.3-.7 3.3-.4 1-1.1 2-1.8 2.7-.8.8-1.7 1.4-2.7 1.8-1 .4-2.1.7-3.3.7h-30c-1.2.0-2.3-.2-3.3-.7-1.1-.4-2-1.1-2.8-1.8-.8-.8-1.4-1.7-1.8-2.7-.4-1-.7-2.2-.7-3.3v-7.7l9.5-1.6v7.7h28.7V47.2l-28.7-.5z"/><path class="st1" d="M505.4 13.4v23.9l26.2-23.9h12.9l-30.8 27.4 32.1 32.6h-12.9l-27.5-28.1v28.1h-10.6v-60h10.6z"/></g></svg></span></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=main_navbar><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=https://neurodesk.org/overview/><span>Overview</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=https://neurodesk.org/getting-started/><span>Getting Started</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class="nav-link active" href=https://neurodesk.org/tutorials-examples/><span class=active>Tutorials & Examples</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=https://neurodesk.org/developers/><span>Developer Documentation</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/NeuroDesk target=_blank><span>GitHub</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=https://neurodesk.org/contact/><span>Contact</span></a></li></ul><div class="navbar-nav d-lg-block"><div class=td-search><div class=td-search--algolia id=docsearch-0></div></div></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=https://neurodesk.org/tutorials-examples/tutorials/spectroscopy/>Return to the regular view of this page</a>.</p></div><h1 class=title>Spectroscopy</h1><div class=lead>Tutorials about performing MR spectroscopy analyses</div><ul><li>1: <a href=#pg-16bdca40061ec1ad8bd42400513f337c>Spectroscopy with lcmodel</a></li><li>2: <a href=#pg-9c021f0163fdf28321444103760ba8ce>Spectroscopy pipeline</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-16bdca40061ec1ad8bd42400513f337c>1 - Spectroscopy with lcmodel</h1><div class=lead>Using lcmodel, you can analyze MR spectroscopy data.</div><blockquote><p><em>This tutorial was created by Steffen Bollmann.</em></p><p>Github: <a href=https://github.com/stebo85 target=_blank rel=noopener>@stebo85</a>
Web: <a href=https://mri.sbollmann.net/ target=_blank rel=noopener>mri.sbollmann.net</a>
Twitter: <a href=https://twitter.com/sbollmann_MRI target=_blank rel=noopener>@sbollmann_MRI</a></p></blockquote><div class="alert alert-info" role=alert><h4 class=alert-heading>Getting Setup with Neurodesk</h4><i>For more information on getting set up with a Neurodesk environment, see <a href=https://neurodesk.org/tutorials-examples>here</a></i></div><p>Open lcmodel from the menu: Applications -> Spectroscopy -> lcmodel -> lcmodel 6.3</p><p>run</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>setup_lcmodel.sh</span></span></code></pre></div></div><p>then run</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>lcmgui</span></span></code></pre></div></div><p>We packed example data into the container (<a href=https://zenodo.org/record/3904443/ target=_blank rel=noopener>https://zenodo.org/record/3904443/</a>) and we will use this to show a basic analysis.</p><p>The example data comes in the Varian fid format, so click on Varian:</p><img width=522 alt=image src=https://user-images.githubusercontent.com/4021595/155111509-967055c2-7ee1-4bf5-b645-6a0b1eee3328.png><p>and then select the fid data in: /opt/datasets/Spectra_hippocampus(rat)_TE02/s_20131015_03_BDL106_scan0/isise_01.fid</p><img width=751 alt=image src=https://user-images.githubusercontent.com/4021595/155111715-305678e9-0c60-4154-bdf3-3aa5ccfd7da1.png><p>Then Change BASIS and select the appropriate basis set in /opt/datasets/Spectra_hippocampus(rat)_TE02/Control_files_Basis_set</p><img width=753 alt=image src=https://user-images.githubusercontent.com/4021595/155111920-9df07a57-beb1-4507-ab7e-2c260a52d91d.png><p>Then hit Run LCModel:</p><img width=812 alt=image src=https://user-images.githubusercontent.com/4021595/155112027-11350513-7616-4158-aca7-d5c0b07397d0.png><p>and confirm:</p><img width=199 alt=image src=https://user-images.githubusercontent.com/4021595/155112122-1b93ff25-7469-4997-8aa6-e96a6784defa.png><p>then wait a couple of minutes until the analyzed spectra appear - by closing the window you can go through the results:</p><img width=893 alt=image src=https://user-images.githubusercontent.com/4021595/155112432-c91bbdef-4701-4fee-a37a-b3bf8f847843.png><p>the results are also saved in ~/.lcmodel/saved/</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9c021f0163fdf28321444103760ba8ce>2 - Spectroscopy pipeline</h1><div class=lead>Using mrsiproc, you can reconstruct and analyze MR spectroscopy data.</div><blockquote><p><em>This tutorial was created by Korbinian Eckstein.</em></p><p>Github: <a href=https://github.com/korbinian90/ target=_blank rel=noopener>@korbinian90</a></p></blockquote><div class="alert alert-info" role=alert><h4 class=alert-heading>Getting Setup with Neurodesk</h4><i>For more information on getting set up with a Neurodesk environment, see <a href=https://neurodesk.org/tutorials-examples>here</a></i></div><div class="alert alert-primary" role=alert><h4 class=alert-heading>Processing MRSI</h4><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>ml mrsiproc/0.1.0</span></span></code></pre></div></div><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>bash Part1_ProcessMRSI.sh [ARGUMENTS]</span></span></code></pre></div></div><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>bash Part2_EvaluateMRSI.sh [ARGUMENTS]</span></span></code></pre></div></div></div><h2 id=starting-neurodesk>Starting Neurodesk</h2><p>After starting Neurodesk, a JupyterLab instance should open. You can either work from here or open a desktop environment by clicking <code>Neurodesktop</code> under <code>Notebooks</code>. This tutorial uses the desktop.</p><p><img src=https://neurodesk.org/static/tutorials-examples/tutorials/spectroscopy/mrsiproc/jupyterlab.png alt=JupyterLab title=JupyterLab></p><h2 id=running-mrsi-reconstruction>Running MRSI reconstruction</h2><p>Open vscode and create and open a new folder under <code>neurodesktop-storage</code></p><p><img src=https://neurodesk.org/static/tutorials-examples/tutorials/spectroscopy/mrsiproc/open_folder.png alt="Open Folder" title="Open Folder"></p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Info</h4><p>The processing can either start from reconstructed DICOM files or exported dat files.
A reconstruction of a dat files might look like this:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Part1_ProcessMRSI.sh \
</span></span><span style=display:flex><span>-c /neurodesktop-storage/data/meas_test.dat \
</span></span><span style=display:flex><span>-t /neurodesktop-storage/data/T1/ \
</span></span><span style=display:flex><span>-a /neurodesktop-storage/data/INV1/ \
</span></span><span style=display:flex><span>-b fid_1.300000ms.basis \
</span></span><span style=display:flex><span>-o /neurodesktop-storage/mrsi_proc/ProcessResults/test_files \
</span></span><span style=display:flex><span>-j LCModel_Control_Template.m \
</span></span><span style=display:flex><span>-m &#34;dreid&#34;</span></span></code></pre></div></div><p>The <code>fid_1.300000ms.basis</code> and <code>LCModel_Control_Template.m</code> files are included</p></div><p>Here, we create a new bash file with the default settings and execute it. Copy the contents of this template file to <code>run_mrsi_part1.sh</code> and replace the <code>-c</code>, <code>-t</code> and <code>-a</code> arguments with your own data and set the output path with <code>-o</code>.</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#57606a>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#57606a></span><span style=color:#57606a># There are two script to process the mrsi data</span>
</span></span><span style=display:flex><span><span style=color:#57606a># First run this script, then run the part 2 script</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ml mrsiproc/0.1.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## The required files are:</span>
</span></span><span style=display:flex><span><span style=color:#57606a># - DAT file / DICOM files</span>
</span></span><span style=display:flex><span><span style=color:#57606a># - T1 (DICOM or .mnc)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## Create own mask (not fully supported yet)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># hd-bet -i /neurodesktop-storage/mrsi_proc/test_files/MP2RAGE/t1.nii.gz -o /neurodesktop-storage/mrsi_proc/test_files/mask.nii.gz -device cpu -mode fast -tta 0</span>
</span></span><span style=display:flex><span><span style=color:#57606a># nii2mnc /neurodesktop-storage/mrsi_proc/test_files/mask.nii.gz /neurodesktop-storage/mrsi_proc/test_files/mask.mnc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Part1_ProcessMRSI.sh <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-c /neurodesktop-storage/data/meas_test.dat <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-t /neurodesktop-storage/data/T1/ <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-a /neurodesktop-storage/data/INV1/ <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-b fid_1.300000ms.basis <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-o /neurodesktop-storage/mrsi_proc/ProcessResults/test_files <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-j LCModel_Control_Template.m <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-m <span style=color:#0a3069>&#34;dreid&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-L <span style=color:#0a3069>&#34;L2,0.2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## HINT</span>
</span></span><span style=display:flex><span><span style=color:#57606a># To change the number of threads used by LCModel, change the number in the LCModel_Control_Template.m file (default 8)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## WARNING -s</span>
</span></span><span style=display:flex><span><span style=color:#57606a># The Julia based recontstruction is still experimental! The algorithm is different, and the results are not expected to be identical. It should be identical to the DICOM output from the ICE version.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## WARNING -m</span>
</span></span><span style=display:flex><span><span style=color:#57606a># If a mask file is given, it must be in *.mnc format</span>
</span></span><span style=display:flex><span><span style=color:#57606a># The word &#34;bet&#34; may not be part of the filename of the mask given to the -m flag</span>
</span></span><span style=display:flex><span><span style=color:#57606a># For a 3D mask, it is suggested to use -m &#34;dreid&#34; instead of -m &#34;bet&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## WARNING -t</span>
</span></span><span style=display:flex><span><span style=color:#57606a># The DICOM folder for giving the T1-weighted image must not contain any other files than *.IMA</span>
</span></span><span style=display:flex><span><span style=color:#57606a># The t1-weighted file can be given as *.mnc file as well</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## The OPTIONS are</span>
</span></span><span style=display:flex><span><span style=color:#57606a># Usage: %s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># mandatory:</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -c	[csi file]			Format: DAT, DICOM, or .mat. If a .mat file is passed over, it is expected that everything is already performed like coil combination etc.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 						You can pass over several files of the same type by \&#39;-c \&#34;[csi_path1] [csi_path2] ...\&#34;\&#39;. These files get individually processed and averaged</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 						at the end.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -b	[basis files]		Format: .BASIS. Used for LCM fitting (for FID)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -B	[basis files]		Format: .BASIS. Used for LCM fitting (spin echo: for fidesi =  fid + echo)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -o	[output directory]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># optional: </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -i	[image NORMAL]		Format: DAT or DICOM. The FoV must match that of the CSI file. Used for our coil combination and for creating mask (if no T1 is inputted)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -f	[image FLIP]		Format: DAT or DICOM. Imaging file FLIP (FOV rotated about -180 deg). Used for correcting gradient delays.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -v	[VC image]	      	Format: DAT or DICOM. Image of volume or body coil file. Used for sensmap method or for creating mask.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -t	[T1 images] 		Format: DICOM. Folder of 3d T1-weighted acquisition containing DICOM files. Used for creating mask and for visual purposes. If minc file is given instead of folder, it is treated as the magnitude file.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -a	[T1 AntiNoise images]	Format: DICOM. Folder of 3d T1-weighted acquisition containing DICOM files. Used for pre-masking the T1w image to get rid of the noise in air-areas.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -w	[Water Reference]	Format: DAT or DICOM. LCModel &#39;Do Water Scaling&#39; or separate water quantification (Water maps are created). The same scan as -c [csi file], but without water suppression.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -m	[mask]			Defines how to create the mask. Options: -m \&#34;bet\&#34;, \&#34;thresh\&#34;, \&#34;voi\&#34;, \&#34;[Path_to_usermade_mask]\&#34;. If not set --&gt; no mask used.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -h 	[100]               	Hamming filter CSI data.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -r 	[InPlaneCaipPattern_And_VD_Radius]	The InPlaneCaipPattern and the VD_Radius as used in ParallelImagingSimReco.m. Example: \&#34;InPlaneCaipPattern = [0 0 0; 0 0 0; 0 0 1]; VD_Radius = 2;\&#34;. </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -R 	[SliceAliasingPattern]</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -g 	[noisedecorr_path]	If this option is used the csi data gets noise decorrelated using noise from passed-over noise file, or if -g \&#34; is given, by noise from the end of the FIDs at the border of the FoV or from the PRESCAN, if available. </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -F    [Nothing]               If this option is set, the spectra are corrected for the first order phase caused by an acquisition delay of the FID-sequences. You must provide a basis set with an appropriate acquisition delay. DONT USE WITH SPIN ECHO SEQUENCES.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -u	[Nothing]               If a phantom was measured. Different settings used for fitting (e.g. some metabolites are omitted)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -I	[\&#34;nextpow2\&#34; Or Vector]If nextpow2: Perform zerofilling to the next power of 2 in ROW and COL dimensions (e.g. from 42x42 to 64x64). If vector (e.g. [16 16 1]): Spatially Interpolate to this size.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -A	[\&#34;\&#34; Or Path]          Perform frequency alignment. If a mnc file is given, use these as B0-map, otherwise shift according to water peak of center voxel.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -l	[Nothing]               If this option is set, LCModel is not started, everything else is done normally. Useful for only computing the SNR.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -j	[LCM_ControlFile]       ControlFile telling LCModel how to process the data. for FID</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -J	[LCM_ControlFile]       ControlFile telling LCModel how to process the data. for ECHO</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -X	[XPACE MOTION LOG]       XPACE MOTION LOG</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 							otherwise standard values are assumed. A template file is provided in this package.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -e	[LineBroadeningInHz]    Apply an exponential filter to the spectra [Hz].</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -s	[threads] [mmap] 		Use the Julia reconstruction version (less RAM usage, different reconstruction algorithm). [threads=auto] can be auto or a number. [mmap=false] can be \&#34;true\&#34;, \&#34;false\&#34; or a path.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -d    [Nothing]				Use the deprecated, old dat file format (before sequence merging, 06/2023)</span></span></span></code></pre></div></div><p>Then run the script with</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>bash run_mrsi_part1.sh</span></span></code></pre></div></div><p><img src=https://neurodesk.org/static/tutorials-examples/tutorials/spectroscopy/mrsiproc/run_mrsi.png alt="Run MRSI" title="Run MRSI"></p><p>This can take several hours for reconstruction and LCModel processing.</p><h2 id=part-2>Part 2</h2><p>Continue with the same process for part 2<br>Template file for part 2</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#57606a>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#57606a></span>
</span></span><span style=display:flex><span>ml mrsiproc/0.1.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Part2_EvaluateMRSI.sh <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-o neurodesktop-storage/mrsi_proc/ProcessResults/test_files <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-S <span style=color:#0a3069>&#34;Glu,Gln,Raw-abs-csi&#34;</span> <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-N Nifti <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-R <span style=color:#0a3069>\
</span></span></span><span style=display:flex><span><span style=color:#0a3069></span>-b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a>## The OPTIONS are</span>
</span></span><span style=display:flex><span><span style=color:#57606a># Usage: %s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># mandatory:</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -o	[output directory]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># optional: </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -d	[print_indiv..._flag]   If this option is set, the SNR gets computed by our own program. If the</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                print_individual_spectra_flag=1 (by using option -d 1) all spectra for </span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                computing the SNR are printed.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -b    [segmentation_matrix_size]</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                If segmentation to GM, WM and CSF should be performed.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#57606a># -s	[CRLB_treshold_value]	user can set the treshold value for CRLB in the metabolic maps</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -n	[SNR_treshold_value]    If this option is set (user set the value of SNR threshold after the flag),</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                SNR binary mask is computed either for LC model SNR or (if the -d flag is set) for</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                custom SNR computation method and LCmodel            </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -f	[FWHM_treshold_value]   If this option is set (user set the value of FWHM threshold after the flag),</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                FWHM binary mask is computed from LCmodel results</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -a    [Control file]          Compute SNR with home-brewed script.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -l    [local_folder]          Perform some of the file-heavy tasks in \$local_folder/tmpx (x=1,2,3,...) instead of on \$out_dir</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#                               directly. This is faster, and if \$out_dir is mounted via nfs4, writing directly to \$out_dir</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#                               can lead to timeouts and terrible zombie processes. </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -k	[spectra_stack_range]	If this option is set, the .Coord files from LCmodel are used to create stacks of spectra</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                to visualize the fit in corresponding voxels (results stored in form of .eps)</span>
</span></span><span style=display:flex><span><span style=color:#57606a>#       				        user can set the starting point of range for stack of spectra for display purposes (in ppm)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                user can set the ending point of range for stack of spectra for display purposes (in ppm)</span>
</span></span><span style=display:flex><span><span style=color:#57606a># 				                Options: \&#34;[&#39;fullrange&#39;]\&#34;, \&#34;[ppm_start; ppm_end]\&#34;</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -r	[non_lin_reg_type]	    If this option is set, the non-linear registration is computed using minctools, Options: -r \&#34;MNI305\&#34;, \&#34;MNI152\&#34;</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -w	[compute_reg_only_flag] If this option is set, only the non-linear registration is computed. </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -q	[compute_seg_only_flag] If this option is set, only the segmentation is computed. </span>
</span></span><span style=display:flex><span><span style=color:#57606a># -N    [\&#34;Nifti\&#34; or \&#34;Both\&#34;] Only create nifti-files. If \&#34;Both\&#34; option is used, create minc and nifti. If -N option is not used, creat only mnc files.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -S    [SpectralMap_flag] 		Create a nifti-file with a map of the LCModel-spectra and -fits to view with freeview as timeseries.\nNeeds freesurfer-linux-centos7_x86_64-dev-20181113-8abd50c, and MATLAB version &gt; R2017b. Can only be used with -N option.</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -u    [UpsampledMaps_flag]	Create upsampled maps by zero-filling (in future more sophisticated methods might be implemented).</span>
</span></span><span style=display:flex><span><span style=color:#57606a># -R    [RatioMaps_flag]		Create Ratio maps.</span></span></span></code></pre></div></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Mastodon aria-label=Mastodon><a target=_blank rel=noopener href=https://masto.ai/@Neurodesk aria-label=Mastodon><i class="fab fa-mastodon responsive-icon"></i>&nbsp;&nbsp;Mastodon</a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/NeuroDesk/discussions aria-label=Discussion><i class="fa fa-envelope responsive-icon"></i>&nbsp;&nbsp;Discussion</a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Acknowledgements aria-label=Acknowledgements><a target=_blank rel=noopener href=https://neurodesk.org/overview/acknowledgement/ aria-label=Acknowledgements><i class="fa fa-handshake responsive-icon"></i>&nbsp;&nbsp;Acknowledgements</a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Metrics aria-label=Metrics><a target=_blank rel=noopener href=https://neurodesk.org/docs/overview/metrics aria-label=Metrics><i class="fa fa-signal responsive-icon"></i>&nbsp;&nbsp;Metrics</a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Uptime aria-label=Uptime><a target=_blank rel=noopener href=https://stats.uptimerobot.com/NBE38IZWZM aria-label=Uptime><i class="fa fa-circle responsive-icon"></i>&nbsp;&nbsp;Uptime</a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://neurodesk.org/js/main.min.371147b5f79a80912e5b0a2cd8f59889c6f0ac501947707b50f470099ce2141c.js integrity="sha256-NxFHtfeagJEuWwos2PWYicbwrFAZR3B7UPRwCZziFBw=" crossorigin=anonymous></script><script defer src=https://neurodesk.org/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.2 integrity="sha512-lsD+XVzdBI6ZquXc8gqbw0/bgrfIsMJwY/8xvmvbN+U3gZSeG7BXQoCq4zv/yCmntR2GLHtgB+bD4ESPsKIbIA==" crossorigin=anonymous></script><script type=text/javascript>const containers=["#docsearch-0","#docsearch-1"];for(let e of containers)docsearch({container:e,appId:"P5JEPQ5LZ2",apiKey:"56c6d9a954f7df2a98dcedb2763af8c4",indexName:"neurodesk"})</script><script src=https://neurodesk.org/js/tabpane-persist.js></script></body></html>